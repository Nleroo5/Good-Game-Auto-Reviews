<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Game - SMS Review System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .section h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #555;
        }

        input[type="tel"], input[type="url"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .message-editor {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: Arial, sans-serif;
            font-size: 1rem;
            line-height: 1.4;
            resize: vertical;
            margin-bottom: 15px;
        }

        .save-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin-right: 10px;
        }

        .save-btn:hover {
            background: #0056b3;
        }

        .reset-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
        }

        .reset-btn:hover {
            background: #545b62;
        }

        .send-btn {
            width: 100%;
            padding: 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .send-btn:hover {
            background: #218838;
        }

        .send-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .message-box {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .status {
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.sending {
            background: #fff3cd;
            color: #856404;
        }

        .bulk-area {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            resize: vertical;
            margin-bottom: 15px;
        }

        .bulk-area:focus {
            outline: none;
            border-color: #007bff;
        }

        .counter {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .char-counter {
            text-align: right;
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .char-counter.warning {
            color: #dc3545;
        }

        .template-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .template-btn {
            background: #e9ecef;
            color: #333;
            border: 1px solid #ced4da;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .template-btn:hover {
            background: #dee2e6;
        }

        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 20px;
            }

            .template-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± SMS Review Requests</h1>

        <!-- Message Customization -->
        <div class="section">
            <h2>Customize Your Message</h2>
            
            <div class="template-buttons">
                <button class="template-btn" onclick="loadTemplate('default')">Default</button>
                <button class="template-btn" onclick="loadTemplate('friendly')">Friendly</button>
                <button class="template-btn" onclick="loadTemplate('professional')">Professional</button>
                <button class="template-btn" onclick="loadTemplate('short')">Short</button>
            </div>

            <textarea class="message-editor" id="messageEditor" placeholder="Enter your custom message here. Use {GOOGLE_LINK} where you want the review link to appear."></textarea>
            
            <div class="char-counter" id="charCounter">0 characters (SMS limit: 160)</div>

            <input type="url" id="googleLinkInput" placeholder="Your Google Review Link" />

            <button class="save-btn" onclick="saveMessage()">Save Message</button>
            <button class="reset-btn" onclick="resetToDefault()">Reset to Default</button>
        </div>

        <!-- Message Preview -->
        <div class="section">
            <h2>Message Preview</h2>
            <div class="message-box" id="messagePreview">Hi! Thanks for choosing Good Game Baseball! If you had a great experience with us today, we'd love if you could leave us a quick Google review. It really helps other families find us! üôè</div>
        </div>

        <!-- Status -->
        <div class="status" id="status" style="display: none;"></div>

        <!-- Single Send -->
        <div class="section">
            <h2>Send to One Number</h2>
            <input type="tel" id="singlePhone" placeholder="Phone number (+1234567890)" />
            <button class="send-btn" onclick="sendSingle()">Send Text</button>
        </div>

        <!-- Bulk Send -->
        <div class="section">
            <h2>Send to Multiple Numbers</h2>
            <textarea class="bulk-area" id="bulkPhones" placeholder="Enter phone numbers, one per line:
+1234567890
+1987654321
+1555123456"></textarea>
            <button class="send-btn" onclick="sendBulk()">Send to All</button>
        </div>

        <!-- Counter -->
        <div class="counter">
            Texts Sent Today: <span id="todayCount">0</span>
        </div>
    </div>

    <script>
        let todayCount = parseInt(localStorage.getItem('sms_count') || '0');
        let customMessage = '';
        let googleLink = '';

        // Message templates
        const templates = {
            default: "Hi! Thanks for choosing Good Game Baseball! If you had a great experience with us today, we'd love if you could leave us a quick Google review. It really helps other families find us! üôè {GOOGLE_LINK}",
            friendly: "Hey there! Hope you loved your session at Good Game Baseball today! üòä If you're happy with our coaching, would you mind leaving us a quick Google review? It would mean the world to us! {GOOGLE_LINK}",
            professional: "Thank you for choosing Good Game Baseball. If you were satisfied with our training services today, we would greatly appreciate a Google review. {GOOGLE_LINK}",
            short: "Thanks for training with Good Game Baseball! Quick Google review? {GOOGLE_LINK} üôè"
        };

        document.getElementById('todayCount').textContent = todayCount;

        function loadTemplate(templateName) {
            const template = templates[templateName];
            document.getElementById('messageEditor').value = template;
            updateCharCounter();
            updatePreview();
        }

        function updateCharCounter() {
            const editor = document.getElementById('messageEditor');
            const counter = document.getElementById('charCounter');
            const length = editor.value.length;
            
            counter.textContent = `${length} characters (SMS limit: 160)`;
            counter.classList.toggle('warning', length > 160);
        }

        function updatePreview() {
            const message = document.getElementById('messageEditor').value;
            const link = document.getElementById('googleLinkInput').value || '[Your Google Review Link]';
            const preview = message.replace('{GOOGLE_LINK}', link);
            document.getElementById('messagePreview').textContent = preview;
        }

        function saveMessage() {
            customMessage = document.getElementById('messageEditor').value;
            googleLink = document.getElementById('googleLinkInput').value;
            
            localStorage.setItem('custom_message', customMessage);
            localStorage.setItem('google_link', googleLink);
            
            updatePreview();
            showStatus('‚úÖ Message saved successfully!', 'success');
        }

        function resetToDefault() {
            loadTemplate('default');
            saveMessage();
        }

        function loadSavedData() {
            const savedMessage = localStorage.getItem('custom_message');
            const savedLink = localStorage.getItem('google_link');
            
            if (savedMessage) {
                document.getElementById('messageEditor').value = savedMessage;
                customMessage = savedMessage;
            } else {
                loadTemplate('default');
            }
            
            if (savedLink) {
                document.getElementById('googleLinkInput').value = savedLink;
                googleLink = savedLink;
            }
            
            updateCharCounter();
            updatePreview();
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        async function sendSMS(phone) {
            try {
                const messageToSend = customMessage.replace('{GOOGLE_LINK}', googleLink);
                
                const response = await fetch('/api/send-sms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        phone: phone,
                        message: messageToSend,
                        action: 'send'
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    showStatus(`‚úÖ Sent to ${phone}`, 'success');
                    todayCount++;
                    document.getElementById('todayCount').textContent = todayCount;
                    localStorage.setItem('sms_count', todayCount);
                } else {
                    showStatus(`‚ùå Failed to send to ${phone}: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus(`‚ùå Error sending to ${phone}`, 'error');
            }
        }

        async function sendSingle() {
            const phone = document.getElementById('singlePhone').value.trim();
            
            if (!phone) {
                showStatus('Please enter a phone number', 'error');
                return;
            }

            if (!customMessage || !googleLink) {
                showStatus('Please save your message and Google link first', 'error');
                return;
            }

            showStatus(`Sending to ${phone}...`, 'sending');
            await sendSMS(phone);
            document.getElementById('singlePhone').value = '';
        }

        async function sendBulk() {
            const phones = document.getElementById('bulkPhones').value
                .split('\n')
                .map(p => p.trim())
                .filter(p => p.length > 0);

            if (phones.length === 0) {
                showStatus('Please enter at least one phone number', 'error');
                return;
            }

            if (!customMessage || !googleLink) {
                showStatus('Please save your message and Google link first', 'error');
                return;
            }

            showStatus(`Sending to ${phones.length} numbers...`, 'sending');

            for (const phone of phones) {
                await sendSMS(phone);
                // Small delay between sends
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            document.getElementById('bulkPhones').value = '';
            showStatus(`Finished sending to ${phones.length} numbers`, 'success');
        }

        // Event listeners
        document.getElementById('messageEditor').addEventListener('input', function() {
            updateCharCounter();
            updatePreview();
        });

        document.getElementById('googleLinkInput').addEventListener('input', updatePreview);

        // Initialize
        loadSavedData();
    </script>
</body>
</html>
